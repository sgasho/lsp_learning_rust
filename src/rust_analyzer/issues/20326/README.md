# ğŸš€ Issue #20326: Move `use` statements to top-level

## ğŸ¯ ä¸€è¨€ã§èª¬æ˜ã™ã‚‹ã¨

é–¢æ•°ã®ä¸­ã«æ›¸ã‹ã‚ŒãŸ `use` æ–‡ã‚’ã€**ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸Šéƒ¨ã«ç§»å‹•**ã•ã›ã‚‹rust-analyzerã®æ–°æ©Ÿèƒ½ã‚’ä½œã‚Šã¾ã™ï¼

## ğŸ” ä½•ãŒå•é¡Œãªã®ï¼Ÿ

```rust
// ğŸ˜µ ã“ã‚“ãªã‚³ãƒ¼ãƒ‰ã‚’è¦‹ãŸã“ã¨ã‚ã‚Šã¾ã›ã‚“ã‹ï¼Ÿ
fn calculate_stats() {
    use std::collections::HashMap;  // â† ãªãœã“ã“ã«ï¼Ÿ
    use serde::Serialize;           // â† æœ¬æ¥ã¯ä¸Šã«ã‚ã‚‹ã¹ã
    
    let mut data = HashMap::new();
    // ...
}

fn read_file() {
    use std::fs::File;              // â† ã¾ãŸã“ã“ã«ã‚‚ï¼
    use std::io::Read;
    
    let file = File::open("data.txt");
    // ...
}
```

### ğŸ¤” ã“ã®å•é¡Œã®ä½•ãŒæ‚ªã„ã®ï¼Ÿ

- **ğŸ“š å¯èª­æ€§ãŒæ‚ªã„**: import ãŒæ•£ã‚‰ã°ã£ã¦ä¾å­˜é–¢ä¿‚ãŒåˆ†ã‹ã‚‰ãªã„
- **ğŸ”„ é‡è¤‡ã®å¯èƒ½æ€§**: åŒã˜ `use` ãŒè¤‡æ•°ã®é–¢æ•°ã«æ›¸ã‹ã‚ŒãŒã¡  
- **ğŸ§¹ ä¿å®ˆæ€§ãŒä½ã„**: import ã®ç®¡ç†ãŒé¢å€’

## ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
20326/
â”œâ”€â”€ ğŸ“„ README.md                    ğŸ‘ˆ ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå…¨ä½“æ¦‚è¦ï¼‰
â”œâ”€â”€ ğŸ“„ overview.md                  ğŸ‘ˆ Issue ã®è©³ç´°èª¬æ˜
â”œâ”€â”€ ğŸ“„ verification.md              ğŸ‘ˆ å‹•ä½œç¢ºèªæ–¹æ³•
â”œâ”€â”€ ğŸ“„ code-analysis.md             ğŸ‘ˆ rust-analyzer ã‚³ãƒ¼ãƒ‰è§£æ
â”œâ”€â”€ ğŸ“„ implementation-strategy.md   ğŸ‘ˆ å®Ÿè£…æ–¹é‡ãƒ»ã‚¹ãƒ†ãƒƒãƒ—
â””â”€â”€ lessons/                        ğŸ‘ˆ å­¦ç¿’æ•™æ
    â”œâ”€â”€ ğŸ“„ README.md                ğŸ‘ˆ å­¦ç¿’ã‚¬ã‚¤ãƒ‰
    â”œâ”€â”€ ğŸ“„ mod.rs                   ğŸ‘ˆ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å®£è¨€
    â”œâ”€â”€ ğŸ“„ ast_basics.rs            ğŸ‘ˆ ASTåŸºç¤å­¦ç¿’
    â””â”€â”€ ğŸ“„ assist_context.rs        ğŸ‘ˆ AssistContextå­¦ç¿’
```

## ğŸ¯ Quick Start

### 1. ğŸ“– Issue ã‚’ç†è§£ã™ã‚‹
```bash
# Issue ã®æ¦‚è¦ã‚’æŠŠæ¡
cat overview.md
```

### 2. ğŸ” ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã‚’ç†è§£ã™ã‚‹  
```bash
# rust-analyzer ã®é–¢é€£ã‚³ãƒ¼ãƒ‰ã‚’ç†è§£
cat code-analysis.md
```

### 3. ğŸ›  å®Ÿè£…è¨ˆç”»ã‚’ç¢ºèªã™ã‚‹
```bash
# æ®µéšçš„ãªå®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—ã‚’ç¢ºèª
cat implementation-strategy.md
```

### 4. ğŸ§ª å‹•ä½œç¢ºèªæ–¹æ³•ã‚’å­¦ã¶
```bash
# ãƒ†ã‚¹ãƒˆæ–¹æ³•ã¨ç¢ºèªæ‰‹é †ã‚’ç†è§£
cat verification.md
```

## ğŸ“ å­¦ç¿’ãƒªã‚½ãƒ¼ã‚¹

### ğŸ“š åŸºç¤æ¦‚å¿µã®å­¦ç¿’
```
lessons/
â”œâ”€â”€ README.md            ğŸ‘ˆ å­¦ç¿’ã®é€²ã‚æ–¹ã‚¬ã‚¤ãƒ‰  
â”œâ”€â”€ mod.rs               ğŸ‘ˆ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å®£è¨€
â”œâ”€â”€ ast_basics.rs        ğŸ‘ˆ AST (æ§‹æ–‡æœ¨) ã®åŸºç¤
â””â”€â”€ assist_context.rs    ğŸ‘ˆ AssistContext ã®ä½¿ã„æ–¹
```

### ğŸ”— å¤–éƒ¨ãƒªã‚½ãƒ¼ã‚¹
- **Issue URL**: https://github.com/rust-lang/rust-analyzer/issues/20326
- **rust-analyzer é–‹ç™ºã‚¬ã‚¤ãƒ‰**: https://github.com/rust-lang/rust-analyzer/blob/master/docs/dev/README.md
- **Assists å®Ÿè£…ä¾‹**: `/crates/ide-assists/src/handlers/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª

## ğŸ¯ å­¦ç¿’ã®é€²ã‚æ–¹

### Phase 1: åŸºç¤ç†è§£ ğŸ“–
1. `overview.md` ã§ Issue ã®è¦ä»¶ã‚’ç†è§£
2. `lessons/README.md` ã§å­¦ç¿’ã®é€²ã‚æ–¹ã‚’ç¢ºèª
3. `lessons/ast_basics.rs` ã§ AST ã®åŸºç¤ã‚’å­¦ç¿’
4. `lessons/assist_context.rs` ã§ AssistContext ã‚’å­¦ç¿’

### Phase 2: ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ç†è§£ ğŸ”
1. `code-analysis.md` ã§ rust-analyzer ã®æ§‹é€ ã‚’ç†è§£
2. å®Ÿéš›ã® rust-analyzer ãƒªãƒã‚¸ãƒˆãƒªã§é–¢é€£ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèª
3. æ—¢å­˜ã® assists å®Ÿè£…ã‚’å‚è€ƒã«ã™ã‚‹

### Phase 3: å®Ÿè£…è¨ˆç”» ğŸ› 
1. `implementation-strategy.md` ã§å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—ã‚’ç¢ºèª
2. ã‚¹ãƒ¢ãƒ¼ãƒ«ã‚¹ãƒ†ãƒƒãƒ—ã§ã®å®Ÿè£…è¨ˆç”»ã‚’ç«‹ã¦ã‚‹
3. ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’å…ˆã«è¨­è¨ˆã™ã‚‹

### Phase 4: å®Ÿè£…ãƒ»æ¤œè¨¼ ğŸš€
1. Phase 1 ã‹ã‚‰é †æ¬¡å®Ÿè£…
2. `verification.md` ã®æ–¹æ³•ã§å‹•ä½œç¢ºèª
3. rust-analyzer ã®ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã§æ¤œè¨¼

## ğŸ’¡ æˆåŠŸã®ã‚³ãƒ„

### âœ… Do's
- **å°ã•ãå§‹ã‚ã‚‹**: æœ€å°é™ã®æ©Ÿèƒ½ã‹ã‚‰å®Ÿè£…
- **ãƒ†ã‚¹ãƒˆé§†å‹•**: å®Ÿè£…å‰ã«ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’æ˜ç¢ºåŒ–  
- **æ—¢å­˜ã‚³ãƒ¼ãƒ‰æ´»ç”¨**: ide-db ã®æ©Ÿèƒ½ã‚’æœ€å¤§é™æ´»ç”¨
- **æ®µéšçš„æ”¹å–„**: Phase æ¯ã«å‹•ä½œç¢ºèª

### âŒ Don'ts  
- ä¸€åº¦ã«å…¨æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ãªã„
- ãƒ†ã‚¹ãƒˆãªã—ã§å®Ÿè£…ã—ãªã„
- æ—¢å­˜ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç„¡è¦–ã—ãªã„
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’å¾Œå›ã—ã«ã—ãªã„

## ğŸ¯ æœ€çµ‚ç›®æ¨™

```rust
// Before (é–¢æ•°å†…ã® use æ–‡)
fn example() {
    use std::collections::HashMap;  // ğŸ‘ˆ ã‚«ãƒ¼ã‚½ãƒ«ã‚’ã“ã“ã«ç½®ã„ã¦ Code Action
    let map = HashMap::new();
}

// After (ãƒ•ã‚¡ã‚¤ãƒ«å…ˆé ­ã«ç§»å‹•)
use std::collections::HashMap;

fn example() {
    let map = HashMap::new();
}
```

**rust-analyzer ã«æ–°ã—ã„æ©Ÿèƒ½ã‚’è²¢çŒ®ã—ã€Rust é–‹ç™ºè€…ã®ç”Ÿç”£æ€§å‘ä¸Šã«å¯„ä¸ã—ã¾ã—ã‚‡ã†ï¼** ğŸ‰

---

ğŸ“ **ã‚µãƒãƒ¼ãƒˆ**: å®Ÿè£…ä¸­ã«è³ªå•ã‚„å•é¡ŒãŒã‚ã‚Œã°ã€å„ãƒ•ã‚¡ã‚¤ãƒ«ã®è©³ç´°èª¬æ˜ã‚’å‚ç…§ã™ã‚‹ã‹ã€rust-analyzer ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã§ç›¸è«‡ã—ã¦ãã ã•ã„ã€‚