# Lesson 2-1: 字句解析（Tokenization）の基礎

lesson_1シリーズが完了しましたね。今度は、**rust-analyzerの核心**である**字句解析**について学びます。

## 📚 字句解析とは？

**字句解析**（Lexing/Tokenization）は、文字列のコードを**意味のある単位（トークン）**に分割する処理です。

### 🤔 なぜ字句解析が必要なのか？

コードは最初は**ただの文字列**です：
```rust
"1 + 2"  // 5文字の文字列
```

この文字列を**トークン**に分割すると：
```rust
[Token::Number(1), Token::Plus, Token::Number(2), Token::Eof]
```

トークンに分割することで、コンピュータは「これは数値、これは演算子」と理解できるようになります。

## 🎯 今回の目標

**入力**: 文字列のコード
```rust
"1 + 2"
```

**出力**: トークンのリスト
```rust
vec![Token::Number(1), Token::Plus, Token::Number(2), Token::Eof]
```

## 🔍 字句解析の基本概念

### 1. 左から右へのスキャン

字句解析器は、文字列を**左から右へ順番に**読んでいきます：

```rust
"1 + 2"
 ↑     ↑     ↑
pos=0 pos=2 pos=4
```

### 2. 文字の分類

各文字を見て、**何の種類のトークンか**を判定します：

```rust
'0'～'9' → 数値の一部
'a'～'z', 'A'～'Z' → 識別子の一部
'+', '-', '*', '/' → 演算子
' ', '\t', '\n' → 空白（スキップ）
```

### 3. 複数文字トークンの処理

**数値**や**識別子**は複数の文字からなるので、**連続して読む**必要があります：

```rust
"123abc"
 ↑
 '1'が数字 → 数値の開始
 '2'が数字 → 続行
 '3'が数字 → 続行
 'a'が数字でない → 数値終了
 結果: Token::Number(123)
```

### 4. 空白の処理

空白文字は**意味を持たない**ので、スキップします：

```rust
"  42   +   x  "
   ↑    ↑    ↑
  数値  演算子 識別子
```

## 🔧 実装のポイント

### 基本的な処理の流れ

1. **現在位置を管理**する変数を用意
2. **文字列を最初から最後まで**順番に読む
3. 各文字で**トークンの種類を判定**
4. 必要に応じて**複数文字を読んで**トークンを完成
5. 完成したトークンを**リストに追加**
6. 最後に**Eofトークン**を追加

### 位置管理の重要性

字句解析では**現在読んでいる位置**を常に把握する必要があります。この位置を使って：

- **次に読む文字**を決定
- **文字列の範囲**を切り出し
- **終端の検出**を行う

### トークンの種類別処理

**数値**: 数字が続く限り読み続けて、最後に文字列から数値に変換

**識別子**: 最初は英字、その後は英数字が続く限り読み続ける

**演算子**: 1文字で判定できるので、文字を見てすぐにトークンを作成

**空白**: 意味を持たないので、見つけたらスキップして次の文字へ

## 🎬 実行例

入力: `"  42   +   hello  "`

```
Step 1: 空白をスキップ → "42   +   hello  "
Step 2: '4'は数字 → 数値として読む → Token::Number(42)
Step 3: 空白をスキップ → "+   hello  "
Step 4: '+'は演算子 → Token::Plus
Step 5: 空白をスキップ → "hello  "
Step 6: 'h'は英字 → 識別子として読む → Token::Identifier("hello")
Step 7: 空白をスキップ → 終了
Step 8: Token::Eof を追加

結果: [Token::Number(42), Token::Plus, Token::Identifier("hello"), Token::Eof]
```

## 🐛 よくある落とし穴

### 1. 位置の更新忘れ
現在位置を進めることを忘れると、**無限ループ**に陥ります。

### 2. 境界チェック
文字列の範囲外にアクセスすると、**パニック**が発生します。

### 3. 文字列の切り出し
Rustでは文字列の切り出しで**バイト境界エラー**が起こることがあります。

## ✅ 実装の進め方

1. **基本構造を作る**：while文で文字列を最初から最後まで読む
2. **空白スキップ**を実装：意味のない文字を飛ばす
3. **数値の読み取り**を実装：連続する数字を読んで数値に変換
4. **識別子の読み取り**を実装：英字から始まり英数字が続く
5. **演算子の読み取り**を実装：1文字で判定
6. **テストで確認**しながら進める

**実行コマンド**: `cargo test lesson_2::lesson_2_1`

## 🎉 完了後

このレッスンが完了すると：
- 字句解析の基本概念が理解できる
- 文字列を意味のある単位に分割できる
- 次のlesson_2_2で構文解析（パース）に進める

**字句解析は全ての言語処理の基礎**です。概念をしっかり理解して進みましょう！