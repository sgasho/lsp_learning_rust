
# Lesson 1-20: 定義の場所へジャンプしよう！ (LSP定義へ移動)

LSPのホバー機能ができるようになりましたね。素晴らしいです！

次に、言語サーバーの非常に強力な機能の一つである「**定義へ移動 (Go to Definition)**」について学びます。エディタが特定のシンボルの定義場所を要求したときに、言語サーバーがどのようにその場所を返すのか、その形式と作成方法を学びます。

## 定義へ移動 (Go to Definition) とは？

定義へ移動機能は、コード中の変数名や関数名などをクリック（または特定のキー操作）すると、そのシンボルが実際に定義されているコードの場所にジャンプできる機能です。これにより、大規模なコードベースでも、関連するコードを素早く見つけることができます。

エディタは、ユーザーが定義へ移動を要求すると、言語サーバーに `textDocument/definition` リクエストを送ります。サーバーはこれに対して、定義場所のリスト（`Location` オブジェクトの配列）を返します。

## `lsp-types::Location` の構造

LSPの定義場所は `lsp_types::Location` という構造体で表現されます。主なフィールドは以下の通りです。

*   `uri`: 定義があるファイルのURI。`lsp_types::Url` を使います。
*   `range`: 定義があるコードの範囲（行と列）。`lsp_types::Range` と `lsp_types::Position` を使います。

## コードの単語を特定し、定義を返す

ホバー機能と同様に、まずカーソル位置にある「単語」を特定する必要があります。Lesson 1-19で実装した単語抽出ロジックを再利用できます。

今回のレッスンでは、シンプルに「`my_function`」という単語がカーソル位置にあれば、その定義場所を返します。定義場所は、簡単のため、常に同じファイル（リクエストがあったファイル）の0行目0文字目とします。

## やってみよう！

あなたの今回のミッションは、`get_definition_location` 関数を完成させることです。

1.  `document_store` から `file_uri` に対応するファイルの内容を取得します。見つからなければ `None` を返します。
2.  `position.line` と `position.character` を使って、カーソル位置にある単語を特定します。Lesson 1-19で使った単語抽出ロジックを参考にしてください。
3.  特定した単語が `"my_function"` であれば、以下の `Location` オブジェクトを返します。
    *   `uri`: リクエストがあったファイルのURI (`file_uri` をそのまま使えます)。
    *   `range`: `Range::new(Position::new(0, 0), Position::new(0, 0))` (0行目0文字目)。
4.  それ以外の単語、または単語が特定できない場合は `None` を返します。

`src/lessons/lesson_1_20.rs` を開いて、挑戦しましょう。

`cargo test` でテストがすべて緑色になったらクリアです！
