
# Lesson 1-3: 封筒に書いてあるページ数を読もう！ (ヘッダーの解析)

お手紙を「封筒」と「便箋」に分けることができるようになりましたね。素晴らしいです！

次なるステップは、封筒に書かれている一番大事な情報、「**便箋のページ数（文字数）**」を正確に読み取ることです。

## なぜページ数が必要なの？

言語サーバーは、エディタから絶え間なくメッセージを受け取ります。もし、あるお手紙の便箋が18ページ（18文字）だと分かっていれば、きっちり18文字だけを読んで、それを一つのメッセージとして処理できます。そして、すぐ次のメッセージを読む準備に入れます。

もしページ数を読まずに処理しようとすると、どこまでが一つのメッセージなのか分からなくなり、複数のメッセージがくっついてしまったり、メッセージの途中で読むのをやめてしまったりと、大混乱が起きてしまいます。

ですから、`Content-Length` ヘッダーから正確に数値を取り出すことは、非常に重要なのです。

## Rustでの文字列操作

このミッションを達成するために、Rustの便利な文字列操作機能をいくつか紹介します。

*   `strip_prefix("...")`: 文字列が特定の部分（`prefix`）で始まっているかチェックし、もしそうならその部分を取り除いた残りの文字列を返します。例えば、`"Content-Length: 123".strip_prefix("Content-Length: ")` は `Some("123")` を返します。

*   `trim()`: 文字列の最初と最後にある空白（スペースや改行など）をすべて取り除きます。`"  123  ".trim()` は `"123"` を返します。

*   `parse::<usize>()`: 文字列を数値に変換しようとします。`"123".parse::<usize>()` は `Ok(123)` という成功した結果を返します。もし `"abc".parse::<usize>()` のように数値にできない場合は `Err(...)` というエラーを返します。

これらの道具を組み合わせれば、どんなヘッダーがきても正しくページ数を読み取れそうですね！

## やってみよう！

あなたの今回のミッションは、`get_content_length` 関数を完成させることです。

1.  入力された文字列（`header`）が `"Content-Length: "` で始まっているか確認します。
2.  始まっていたら、その部分を取り除いて、残りの部分（数値のはず）を取得します。
3.  取得した数値の部分から、余計な空白を取り除きます。
4.  きれいになった文字列を、`usize` 型の数値に変換します。
5.  すべてが成功したら `Some(数値)` を、途中で何か問題があったら `None` を返してください。

`src/lessons/lesson_1_3.rs` を開いて、挑戦しましょう。

`cargo test` でテストがすべて緑色になったらクリアです！
