
# Lesson 1-1: お手紙のルールを学ぼう！ (LSPメッセージの基本形式)

こんにちは！ `rust-analyzer` のような賢いプログラミングのお手伝いツール（これを「言語サーバー」と呼びます）が、どうやってエディタ（VS Codeなど）とお話しているか、その秘密を探る冒険に出かけましょう！

## 言語サーバーとエディタの「お手紙交換」

言語サーバーとエディタは、目に見えない速さで「お手紙」を交換しています。このお手紙のおかげで、コードを書いている途中で間違いを教えてくれたり、便利なヒントを出してくれたりするのです。

でも、ただお手紙を書けばいいわけではありません。ちゃんと相手に読んでもらうためには、守らなければならない「お手紙のルール」があります。これが **LSP (Language Server Protocol)** です。

## LSPのお手紙のルール

LSPのお手紙は、2つの部分からできています。

1.  **封筒 (Header)**
2.  **便箋 (Content)**

### 1. 封筒 (Header)

封筒には、とても大事なことが一つだけ書かれています。

`Content-Length: 18`

これは「**これから送る便箋には、18文字書いてありますよ**」という意味です。受け取った側は、この数字を見て「なるほど、18文字だけ読めばいいんだな」と分かります。文字数を正確に伝えることで、どこまでがお手紙の本文なのかがはっきりするのです。

封筒の最後には、必ず「改行・改行」を意味する特別な記号 `\r\n\r\n` をつけます。これは「封筒はここまでです。次からが便箋ですよ」という合図です。

### 2. 便箋 (Content)

便箋には、伝えたいメッセージそのものを書きます。LSPでは、このメッセージは **JSON** という形式で書く、というルールになっています。

今回のレッスンで作るメッセージは、とてもシンプルです。

`{"jsonrpc":"2.0"}`

これは「**これからJSON-RPCというバージョンのルールでお話しますよ**」という挨拶のようなものです。

## やってみよう！

あなたの最初のミッションは、この「封筒」と「便箋」を正しく組み立てて、一つのお手紙（文字列）を作ることです。

1.  まず、便箋となるJSON文字列 `{"jsonrpc":"2.0"}` を用意します。
2.  このJSON文字列の「文字数」を数えます。（半角の文字も記号も、全部1文字と数えます）
3.  数えた文字数を使って、`Content-Length: (数えた文字数)` という封筒のヘッダー部分を作ります。
4.  最後に、`ヘッダー` + `\r\n\r\n` + `JSON文字列` の順番に全部を合体させます。

`lessons/lesson_1_1.rs` ファイルを開いて、`create_lsp_message` 関数を改造し、このルールに合った正しいお手紙を返すようにしてみてください。

できあがったら、ターミナルで `cargo test` と入力してみましょう。もしテストが全部緑色になったら、ミッション成功です！

