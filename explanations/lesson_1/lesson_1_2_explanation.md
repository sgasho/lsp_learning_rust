
# Lesson 1-2: 届いたお手紙を開けてみよう！ (LSPメッセージの分割)

前回は、ルールに従って「お手紙を作る」練習をしましたね。今回は、エディタから「届いたお手紙を開ける」練習です。

## なぜ分割するの？

LSPのメッセージは、「封筒（ヘッダー）」と「便箋（コンテンツ）」がくっついた一つの長い文字列として送られてきます。

`Content-Length: 18\r\n\r\n{"jsonrpc":"2.0"}`

このままでは、どこまでがヘッダーでどこからがコンテンツなのか分かりません。そこで、まずやるべきことは、この長い文字列を「封筒」と「便箋」の２つにきれいに分けることです。

LSPのルールでは、この２つは必ず特別な区切り文字 `\r\n\r\n` で分けられています。この区切り文字を見つけることが、お手紙を開けるための「カギ」になります。

## Rustでの文字列の分割

Rustには、特定の文字や文字列で、元の文字列を分割するための便利な機能が用意されています。例えば、`splitn` というメソッドを使うと、「最初の1個目の区切り文字で、2つに分割する」といったことができます。

```rust
let text = "first-second";
let parts: Vec<&str> = text.splitn(2, '-').collect();

// parts[0] は "first"
// parts[1] は "second"
```

この考え方を使えば、LSPメッセージも分割できそうですね！

## Option型: 成功と失敗

もし、届いたお手紙がルール通りに書かれていなくて、区切り文字 `\r\n\r\n` が見つからなかったらどうしましょう？そんなときは「お手紙の開封に失敗しました」と伝える必要があります。

Rustでは、このような「成功かもしれないし、失敗かもしれない」という状況を表すのに `Option` という型を使います。

*   **成功した場合:** `Some(値)` という形で、成功した結果（今回はヘッダーとコンテンツのペア）を返します。
*   **失敗した場合:** `None` という値を返します。

## やってみよう！

あなたの今回のミッションは、`parse_lsp_message` 関数を完成させることです。

1.  入力された文字列（`message`）に、区切り文字 `\r\n\r\n` が含まれているか探します。
2.  もし見つかったら、それを基準に文字列をヘッダーとコンテンツの２つに分割し、`Some((ヘッダー, コンテンツ))` の形で返します。
3.  もし見つからなかったら、`None` を返します。

`src/lessons/lesson_1_2.rs` ファイルを開いて、挑戦してみてください。

できあがったら、ターミナルで `cargo test` と入力して、テストがすべて緑色になるか確認しましょう！

