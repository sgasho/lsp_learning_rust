
# Lesson 1-7: エディタの命令を理解しよう！ (LSPメソッド)

LSPメッセージが「質問（リクエスト）」なのか「報告（通知）」なのかを区別できるようになりましたね。素晴らしいです！

次に重要なのは、そのメッセージが「何を要求しているのか」を知ることです。これはLSPの「**メソッド (Method)**」によって示されます。

## メソッドとは？

メソッドは、エディタが言語サーバーに実行してほしい「**命令**」や「**アクション**」の名前です。例えば、以下のようなメソッドがあります。

*   `textDocument/didOpen`: 「このファイルを開きましたよ」という通知。
*   `textDocument/completion`: 「この場所でコード補完の候補が欲しいです」というリクエスト。
*   `textDocument/definition`: 「このシンボルの定義場所にジャンプしたいです」というリクエスト。
*   `textDocument/hover`: 「このシンボルにマウスカーソルを合わせたので、情報が欲しいです」というリクエスト。

言語サーバーは、このメソッド名を見て、次に何をすべきかを判断します。

## `serde_json::Value` から文字列を安全に抽出する

LSPメッセージのJSONコンテンツは `serde_json::Value` 型としてパースされます。この `Value` から特定のフィールド（今回は `method`）を取り出し、それが文字列であることを確認するには、いくつかの方法があります。

*   `json_value.get("method")`: `Value` から指定されたキーの値を `Option<&Value>` として取得します。キーが存在しない場合は `None` を返します。
*   `value.as_str()`: `&Value` が文字列型であれば `Some(&str)` を、そうでなければ `None` を返します。これにより、値が本当に文字列であることを安全に確認できます。
*   `map(|s| s.to_string())`: `Option<&str>` が `Some` の場合、その `&str` を `String` に変換します。`String` は所有権を持つ文字列なので、関数から返すのに適しています。

これらのメソッドを組み合わせることで、`method` フィールドを安全に抽出し、`String` として返すことができます。

## やってみよう！

あなたの今回のミッションは、`get_lsp_method` 関数を完成させることです。

1.  入力された `json_value` から `"method"` フィールドを取得します。
2.  取得した値が文字列であることを確認します。
3.  もし `"method"` フィールドが存在し、それが文字列であれば、その文字列を `String` に変換して `Some(String)` として返します。
4.  それ以外の場合は `None` を返します。

`src/lessons/lesson_1_7.rs` を開いて、挑戦しましょう。

`cargo test` でテストがすべて緑色になったらクリアです！
