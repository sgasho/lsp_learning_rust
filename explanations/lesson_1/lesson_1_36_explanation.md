# Lesson 1-36: ã‚³ãƒ¼ãƒ‰ã«æƒ…å ±ã‚’è¡¨ç¤ºã—ã‚ˆã†ï¼ (LSPã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ³ã‚º)

Selection Rangeæ©Ÿèƒ½ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã­ã€‚ä»Šåº¦ã¯ã€**ã‚³ãƒ¼ãƒ‰ã®ä¸Šã«å®Ÿè¡Œå¯èƒ½ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º**ã™ã‚‹æ©Ÿèƒ½ã‚’å­¦ã³ã¾ã™ã€‚

## ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ³ã‚º (Code Lens) ã¨ã¯ï¼Ÿ

### ğŸ“– æ¦‚å¿µã®è©³ç´°èª¬æ˜

ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ³ã‚ºã¯ã€**é–¢æ•°ã‚„ã‚¯ãƒ©ã‚¹ã®ä¸Šã«è¡¨ç¤ºã•ã‚Œã‚‹å°ã•ãªãƒœã‚¿ãƒ³**ã®ã‚ˆã†ãªæ©Ÿèƒ½ã§ã™ã€‚

**å¾“æ¥ã®é–‹ç™ºä½“é¨“**:
- é–¢æ•°ã‚’å®Ÿè¡Œã—ãŸã„ â†’ æ‰‹å‹•ã§ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ
- ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ãŸã„ â†’ åˆ¥ã®ãƒ„ãƒ¼ãƒ«ã‚’èµ·å‹•
- å‚ç…§ã‚’èª¿ã¹ãŸã„ â†’ æ¤œç´¢ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨

**âœ¨ ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ³ã‚ºï¼ˆä¾¿åˆ©ãªä½“é¨“ï¼‰**:
- é–¢æ•°ã®ä¸Šã«ã€Œâ–¶ Run testã€ãƒœã‚¿ãƒ³ãŒè¡¨ç¤º
- ã‚¯ãƒªãƒƒã‚¯ä¸€ã¤ã§ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
- **ã‚³ãƒ¼ãƒ‰ã¨é€£å‹•ã—ãŸç›´æ„Ÿçš„ãªUI**

### ğŸ¯ å®Ÿéš›ã®è¡¨ç¤ºä¾‹

```rust
â–¶ Run function                    // â† ã“ã®ãƒœã‚¿ãƒ³ãŒã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ³ã‚º
fn main() {
    println!("Hello World");
}

ğŸ” Show references              // â† ã“ã®ãƒœã‚¿ãƒ³ã‚‚ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ³ã‚º  
fn calculate(x: i32) -> i32 {
    x * 2
}

ğŸ§ª Run test                     // â† ãƒ†ã‚¹ãƒˆå°‚ç”¨ã®ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ³ã‚º
#[test]
fn test_example() {
    assert_eq!(1, 1);
}
```

å„é–¢æ•°ã®**å½¹å‰²ã«å¿œã˜ãŸé©åˆ‡ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³**ãŒæä¾›ã•ã‚Œã‚‹ï¼

## CodeLensæ§‹é€ ä½“ã®è©³ç´°

```rust
pub struct CodeLens {
    pub range: Range,              // ãƒ¬ãƒ³ã‚ºã‚’è¡¨ç¤ºã™ã‚‹ä½ç½®
    pub command: Option<Command>,  // ã‚¯ãƒªãƒƒã‚¯æ™‚ã«å®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰
    pub data: Option<serde_json::Value>, // è¿½åŠ ãƒ‡ãƒ¼ã‚¿
}

pub struct Command {
    pub title: String,             // ãƒœã‚¿ãƒ³ã«è¡¨ç¤ºã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆ
    pub command: String,           // å®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ID
    pub arguments: Option<Vec<serde_json::Value>>, // ã‚³ãƒãƒ³ãƒ‰ã®å¼•æ•°
}
```

### ğŸ” ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æ„å‘³

- **`range`**: ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ³ã‚ºã‚’è¡¨ç¤ºã™ã‚‹ä½ç½®ï¼ˆé€šå¸¸ã¯é–¢æ•°åã®ç¯„å›²ï¼‰
- **`command`**: ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã®å‹•ä½œ
- **`title`**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¡¨ç¤ºã•ã‚Œã‚‹ãƒ†ã‚­ã‚¹ãƒˆï¼ˆ"Run test"ãªã©ï¼‰
- **`command`**: ã‚¨ãƒ‡ã‚£ã‚¿ãŒå®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã®ID

### ğŸ—ï¸ é–¢æ•°ã‚¿ã‚¤ãƒ—ã¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®å¯¾å¿œ

```rust
#[derive(Debug, PartialEq)]
enum FunctionType {
    Test,    // #[test] ä»˜ãã®ãƒ†ã‚¹ãƒˆé–¢æ•°
    Main,    // mainé–¢æ•°ï¼ˆã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆï¼‰
    Regular, // ãã®ä»–ã®é€šå¸¸é–¢æ•°
}

// é–¢æ•°ã‚¿ã‚¤ãƒ—ã”ã¨ã®é©åˆ‡ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³
match function_type {
    FunctionType::Test => "Run test",        // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
    FunctionType::Main => "Run function",    // ãƒ—ãƒ­ã‚°ãƒ©ãƒ å®Ÿè¡Œ
    FunctionType::Regular => "Show references", // å‚ç…§è¡¨ç¤º
}
```

## å®Ÿè£…ã®ãƒã‚¤ãƒ³ãƒˆ

### 1. é–¢æ•°æ¤œå‡ºã®åŸºæœ¬ãƒ‘ã‚¿ãƒ¼ãƒ³
- `fn ` ã§å§‹ã¾ã‚‹è¡Œã‚’æ¤œå‡º
- é–¢æ•°åã‚’æ­£ç¢ºã«æŠ½å‡º
- å‰è¡Œã®`#[test]`ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯

### 2. ä½ç½®è¨ˆç®—
- é–¢æ•°åã®æ­£ç¢ºãªç¯„å›²ã‚’è¨ˆç®—
- ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ³ã‚ºã¯é–¢æ•°å®šç¾©è¡Œã«é…ç½®

### 3. Commandä½œæˆ
```rust
Command {
    title: "Run test".to_string(),
    command: "rust.test.run".to_string(),
    arguments: Some(vec![
        serde_json::Value::String(function_name.to_string())
    ]),
}
```

## ã‚„ã£ã¦ã¿ã‚ˆã†ï¼

`provide_code_lenses`é–¢æ•°ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„ï¼š

1. é–¢æ•°å®šç¾©ã‚’æ¤œå‡ºï¼ˆ`find_function_definitions`ï¼‰
2. é–¢æ•°ã‚¿ã‚¤ãƒ—ã‚’åˆ¤å®šï¼ˆ`determine_function_type`ï¼‰  
3. é©åˆ‡ãªCommandã‚’ä½œæˆï¼ˆ`create_command_for_function`ï¼‰
4. CodeLensã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¦è¿”ã™

`cargo test lesson_1_36`ã§ãƒ†ã‚¹ãƒˆãŒã™ã¹ã¦ç·‘è‰²ã«ãªã£ãŸã‚‰ã‚¯ãƒªã‚¢ã§ã™ï¼